var ne=Object.defineProperty,le=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var X=(t,o,n)=>o in t?ne(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,N=(t,o)=>{for(var n in o||(o={}))z.call(o,n)&&X(t,n,o[n]);if(M)for(var n of M(o))V.call(o,n)&&X(t,n,o[n]);return t},G=(t,o)=>le(t,ie(o));var K=(t,o)=>{var n={};for(var r in t)z.call(t,r)&&o.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&M)for(var r of M(t))o.indexOf(r)<0&&V.call(t,r)&&(n[r]=t[r]);return n};import{j as e,n as ae,a as i,c as ce,f as $,b as W,B as de,d as ue,e as E,g as b,r as c,M as C,m as Q,A as me,I as Y,R as P,h as S}from"./vendor.react.js";const pe=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}};pe();function k(){return e("div",{className:"spinner-wrapper text-center",children:e("div",{className:"spinner-border",role:"status"})})}const Z=t=>{let o=null;if(document.cookie&&document.cookie!==""){const n=document.cookie.split(";");for(let r=0;r<n.length;r++){const s=n[r].trim();if(s.substring(0,t.length+1)===t+"="){o=decodeURIComponent(s.substring(t.length+1));break}}}return o},T=t=>{let o="0 a";return 1e3<t&&t<1e5&&(o="0.0 a"),ae(t).format(o)},he=async t=>"clipboard"in navigator?await navigator.clipboard.writeText(t):document.execCommand("copy",!0,t),fe=t=>new FormData(t.currentTarget),I=({userCanEdit:t,postId:o,postAuthor:n,editUrl:r,created:s,updated:l,deleteCallback:a})=>{const p=Z("csrftoken"),u=new Date(Number(s)),m=new Date(Number(l)),h=()=>{b.delete(`/api/v1/posts/${o}`,{headers:{"X-CSRFToken":p}}).then(d=>{d.status===204&&a()}).catch(d=>{console.error(d)})};return i("div",{className:"post-head mb-2",children:[e("div",{className:"author-picture me-1",children:e("a",{href:n.profile_url,children:e("img",{className:"profile-picture-medium rounded",src:n.profile_picture,alt:"profile picture"})})}),i("div",{className:"post-info ms-2",children:[e("div",{className:"post-author-username",children:e("a",{href:n.profile_url,children:e("span",{className:"pointer-hover-underline text-break",children:n.username})})}),e("div",{className:"post-time text-muted",children:ce(m,u)===1?i("small",{className:"updated",title:`Created: ${$(u,"yyyy/MM/dd' 'HH:mm:ss.sss")} | Updated: ${$(m,"yyyy/MM/dd' 'HH:mm:ss.sss")}`,children:[W(m,{addSuffix:!0}),e("i",{className:"bi bi-pencil ms-2"})]}):e("small",{className:"created",title:$(u,"yyyy/MM/dd' 'HH:mm:ss.sss"),children:W(u,{addSuffix:!0})})})]}),t&&e(de,{className:"ms-auto h-75",children:i(ue,{children:[e(E,{variant:"outline-secondary",onClick:()=>window.location.href=r,title:"Edit post",children:e("i",{className:"bi bi-pencil"})}),e(E,{variant:"outline-secondary",onClick:()=>h(),title:"Delete post",children:e("i",{className:"bi bi-trash"})})]})})]})},q=({body:t,pictureUrl:o,parentData:n})=>{const[r,s]=c.exports.useState(!1),l=()=>s(!0),a=()=>s(!1);return i("div",{children:[i("div",{className:"post-body",children:[n&&e("div",{className:"post-parent",children:e("a",{href:n.parent_url,children:i("small",{className:"parent-info text-muted text-break text-wrap",children:["Replying to ",n.parent_author.username]})})}),e("p",{children:t})]}),o?e("div",{children:e("div",{className:"post-picture",children:e("img",{className:"post-img modal-img img-thumbnail mx-auto d-block",onClick:()=>r?a():l(),src:o,alt:"post picture"})})}):null,i(C,{show:r,onHide:a,size:"lg",centered:!0,children:[e(C.Body,{children:e("img",{className:"w-100",src:o,alt:"post picture"})}),e(C.Footer,{children:e(E,{variant:"primary",onClick:a,children:"Close"})})]})]})},F=s=>{var l=s,{className:t,children:o,handleClick:n}=l,r=K(l,["className","children","handleClick"]);return e(Q.div,G(N({onClick:n,whileHover:{scale:1.4},whileTap:{scale:.9},className:t},r),{children:o}))},ee=({requestUserId:t,postId:o,postDetailUrl:n,postLikeCount:r,postCommentCount:s})=>{const l=getCookie("csrftoken"),[a,p]=c.exports.useState(r),[u,m]=c.exports.useState(!1);c.exports.useEffect(()=>{t&&b.get(`/api/v1/users/${t}/liked/${o}/`).then(x=>{m(x.data.is_liked)}).catch(x=>{console.error(x)})},[]);const h=()=>window.location.href=n,d=()=>{const x=u?"dislike":"like";b.post(`/api/v1/posts/${o}/like/`,{action:x},{headers:{"Content-Type":"application/json","X-CSRFToken":l}}).then(f=>{p(f.data.like_count),m(!u)}).catch(f=>{f.response&&f.response.status===403&&(window.location.pathname="/accounts/login/"),console.error(f)})};return i("div",{className:"post-bottom user-select-none d-flex flex-row",children:[s!==void 0&&i(F,{className:"comments d-flex flex-row justify-content-center align-items-center bd-highlight",handleClick:h,children:[e("i",{className:"bi bi-chat"}),e("span",{className:"p-2",children:s>0?T(s):e("span",{children:"\xA0"})})]}),a!==void 0&&i(F,{className:`likes ${u&&"liked"} d-flex flex-row justify-content-center align-items-center bd-highlight`,handleClick:d,children:[e("i",{className:`bi ${u?"bi-heart-fill":"bi-heart"}`}),e("span",{className:"p-2",children:a>0?T(a):e("span",{children:"\xA0"})})]}),n!==void 0&&e(F,{className:"share d-flex flex-row justify-content-center align-items-center bd-highlight",title:"Copy URL",handleClick:async()=>{await he(n)},children:e("i",{className:"bi bi-box-arrow-up"})})]})};const ge=({post:t,requestUserId:o,requestUserIsStaff:n})=>{const{id:r,parent_post:s,body:l,comment_count:a,like_count:p,url:u,picture_url:m,post_author:h,created:d,updated:x,edit_url:f}=t,y=o===h.user_id||n,[v,g]=c.exports.useState(!0);return e(me,{exitBeforeEnter:!0,onExitComplete:()=>null,children:v&&e(Q.div,{initial:{y:"20vh",opacity:0},animate:{y:"0",opacity:1},exit:{y:"-20vh",opacity:0},transition:{duration:.4},children:i("div",{className:"post my-4 p-5 bg-light border rounded-3",children:[e(I,{userCanEdit:y,postId:r,postAuthor:h,postDetailUrl:u,editUrl:f,created:d,updated:x,deleteCallback:()=>g(!1)}),e(q,{body:l,pictureUrl:m,parentData:s}),e("hr",{}),e(ee,{requestUserId:o,postId:r,postDetailUrl:u,postLikeCount:p,postCommentCount:a})]})},`post-${r}`)})};const D=({newestPost:t,sourceUrl:o,endMessage:n,requestUserId:r,requestUserIsStaff:s})=>{r=parseInt(r),s=s==="True";const l="/api/v1/posts/",[a,p]=c.exports.useState([]),[u,m]=c.exports.useState(0),[h,d]=c.exports.useState(!1),[x,f]=c.exports.useState(o||l);c.exports.useEffect(()=>{t!==null&&p([t,...a])},[t]),c.exports.useEffect(()=>{y()},[]);const y=async()=>{d(!1);try{const v=await b.get(x);p([...a,...v.data.results]),m(v.data.count);let g=v.data.next;g!==null&&(g=new URL(v.data.next),g.protocol="https:",g=g.toString()),f(g)}catch{d(!0)}};return e(Y,{dataLength:a.length,next:y,hasMore:a.length<u,loader:e(k,{}),endMessage:n||e("hr",{}),scrollThreshold:.9,children:a.map((v,g)=>e("div",{children:e(ge,{post:v,requestUserId:r,requestUserIsStaff:s})},g))})},te=({parentPostId:t,isReply:o,newPostCallback:n})=>{const r=Z("csrftoken"),[s,l]=c.exports.useState(!1);return i("div",{className:"card-body",children:[i("form",{onSubmit:m=>{m.preventDefault(),l(!0);const h=fe(m);b.post("/api/v1/posts/",h,{headers:{"Content-Type":"multipart/form-data","X-CSRFToken":r}}).then(function(d){n(d.data)}).catch(d=>{console.error(d)}).finally(()=>l(!1)),m.currentTarget.reset()},id:"post-form",method:"POST",enctype:"multipart/form-data",children:[e("input",{type:"hidden",name:"parent_post",value:t}),e("div",{id:"div_id_body",className:"mb-3",children:e("textarea",{name:"body",cols:"40",rows:"4",maxlength:"240",placeholder:o?"Reply...":"What's on your mind?",className:"textarea form-control",required:!0,id:"id_body",disabled:s})}),i("div",{className:"row",children:[e("div",{className:"col-lg-9",children:e("div",{id:"div_id_picture",className:"mb-3",children:e("div",{className:" mb-2",children:e("div",{id:"div_id_picture",className:"mb-3",children:e("div",{className:" mb-2",children:e("div",{children:e("input",{type:"file",name:"picture_url",className:"form-control",accept:"image/*",required:!1,id:"id_picture",disabled:s})})})})})})}),e("div",{className:"col-md ",children:e("div",{className:"ms-lg-3 pe-lg-3 w-100",children:e("button",{id:"post-submit-btn",type:"submit",className:"btn btn-primary w-100",disabled:s,children:o?"Reply":"Post"})})})]})]}),s&&e(k,{})]})},xe=({requestUserId:t,requestUserIsStaff:o})=>{const[n,r]=c.exports.useState(null),s=t!=="None",l=`/api/v1/users/${t}/feed/`;return i("div",{children:[s&&e(te,{newPostCallback:p=>r(p)}),e(D,{newestPost:n,sourceUrl:s&&l,endMessage:e("div",{className:"d-flex justify-content-center",children:i("p",{children:["Check",e("span",{role:"button",onClick:()=>window.location.pathname="/explore",className:"mx-2 link-primary",children:e("strong",{children:e("u",{children:"Explore"})})}),"tab to see all posts"]})}),requestUserId:t,requestUserIsStaff:o})]})},L=t=>{const[o,n]=c.exports.useState(null),[r,s]=c.exports.useState(null),[l,a]=c.exports.useState(!1);return c.exports.useEffect(()=>{(async()=>{a(!0);try{const u=await b.get(t);n(u.data)}catch(u){s(u)}finally{a(!1)}})()},[t]),{data:o,loading:l,error:r}};const ve=({profileData:t})=>{const{username:o,profile_picture:n,profile_url:r}=t;return i("div",{role:"button",className:"d-flex my-2",onClick:()=>window.location.href=r,children:[e("img",{className:"profile-picture-medium rounded",src:n,alt:"Profile picture"}),e("p",{className:"pointer-hover-underline text-break ms-2 mt-3",children:o})]})},be=({sourceUrl:t})=>{const[o,n]=c.exports.useState([]),[r,s]=c.exports.useState(0),[l,a]=c.exports.useState(!1),[p,u]=c.exports.useState(t);c.exports.useEffect(()=>{m()},[]);const m=async()=>{a(!1);try{const h=await b.get(p);n([...o,...h.data.results]),s(h.data.count);let d=h.data.next;d!==null&&(d=new URL(h.data.next),d.protocol="https:",d=d.toString()),u(d)}catch{a(!0)}};return e("div",{id:"scrollableDiv",className:"overflow-auto",style:{maxHeight:"50vh"},children:e(Y,{dataLength:o.length,next:m,hasMore:o.length<r,loader:e(k,{}),scrollableTarget:"scrollableDiv",children:o.map((h,d)=>e("div",{children:e(ve,{profileData:h})},d))})})},ye=({profileId:t,username:o,bio:n,followersCount:r,followingCount:s,pictureUrl:l,backgroundUrl:a,requestUserId:p})=>{const u=getCookie("csrftoken"),m=`/api/v1/profiles/${t}/followers/`,h=`/api/v1/profiles/${t}/following/`,[d,x]=c.exports.useState(r),[f,y]=c.exports.useState(!1),[v,g]=c.exports.useState(!1),[oe,se]=c.exports.useState(m);c.exports.useEffect(()=>{p&&b.get(`/api/v1/profiles/${t}/is-following/${p}/`).then(w=>{y(w.data.is_following)}).catch(w=>{console.error(w)})},[]);const re=()=>{const w=f?"unfollow":"follow";b.post(`/api/v1/profiles/${t}/follow/`,{action:w},{headers:{"Content-Type":"application/json","X-CSRFToken":u}}).then(_=>{x(_.data.followers_count),y(!f)}).catch(_=>{_.response&&_.response.status===403&&(window.location.pathname="/accounts/login/"),console.error(_)})},A=w=>{se(w),g(!0)},O=()=>{g(!1)};return i("div",{children:[e("div",{className:"profile-background",id:"profile-background",children:e("img",{className:"w-100 rounded-3 modal-img",src:a,alt:"Profile background"})}),i("div",{className:"profile-header d-flex flex-column flex-md-row align-items-center justify-content-center justify-content-md-evenly flex-wrap rounded-3",children:[e("img",{className:"img-thumbnail modal-img",id:"profile-picture",src:l,alt:"Profile picture"}),e("p",{className:"display-6 profile-header-username text-break text-center",children:o}),i("div",{className:"follow-info d-flex flex-row align-items-center justify-content-around user-select-none",children:[i("div",{role:"button",className:"pointer-hover-underline",onClick:()=>{s>0&&A(h)},children:[T(s),e("small",{className:"text-muted",children:"Following"})]}),i("div",{role:"button",className:"pointer-hover-underline",onClick:()=>{d>0&&A(m)},children:[T(d),e("small",{className:"text-muted",children:"Followers"})]})]}),e("div",{className:"profile-bio w-100 mt-2 text-muted",children:e("p",{className:"text-center",children:n})}),e(E,{className:"px-4",onClick:re,variant:f?"danger":"primary",children:f?"Unfollow":"Follow"})]}),i(C,{show:v,onHide:O,size:"sm",centered:!0,children:[e(C.Body,{children:e(be,{sourceUrl:oe})}),e(C.Footer,{children:e(E,{variant:"primary",onClick:O,children:"Close"})})]})]})},we=({profileId:t,requestUserId:o,requestUserIsStaff:n})=>{t=parseInt(t),o=parseInt(o);const r=`/api/v1/users/${t}/posts`,{data:s,loading:l,error:a}=L(`/api/v1/profiles/${t}/`);return i("div",{children:[l&&e(k,{}),s&&i("div",{children:[e(ye,{profileId:t,username:s.username,bio:s.bio,followersCount:s.followers_count,followingCount:s.following_count,pictureUrl:s.profile_picture,backgroundUrl:s.profile_background,requestUserId:o}),s.posts_count>0?e(D,{newestPost:null,sourceUrl:r,requestUserId:o,requestUserIsStaff:n}):e("div",{className:"mt-4 d-flex flex-row justify-content-center",children:e("h3",{children:"No posts yet."})})]})]})},Ne=({parentId:t,anyComments:o,requestUserId:n,requestUserIsStaff:r})=>{const s=`/api/v1/posts/${t}/comments/`,l=!isNaN(n),[a,p]=c.exports.useState(null);return i("div",{children:[l&&e(te,{parentPostId:t,isReply:!0,newPostCallback:u=>p(u)}),(o||a!==null)&&i("div",{className:"comments my-4",children:[e("h2",{children:"Comments"}),e("div",{className:"comments-content",children:e(D,{newestPost:a,sourceUrl:s,requestUserId:n,requestUserIsStaff:r})})]})]})},ke=({postId:t,requestUserId:o,requestUserIsStaff:n})=>{o=parseInt(o),n=n==="True";const{data:r,loading:s,error:l}=L(`/api/v1/posts/${t}/`);return i("div",{children:[s&&e(k,{}),r&&i("div",{className:"post my-4 p-5 bg-light border rounded-3",children:[e(I,{userCanEdit:o===r.post_author.user_id||n,postId:t,postAuthor:r.post_author,editUrl:r.editUrl,created:r.created,updated:r.updated,deleteCallback:()=>window.location.pathname="/"}),e(q,{body:r.body,pictureUrl:r.picture_url,parentData:r.parent_post}),e("hr",{}),e(ee,{requestUserId:o,postId:t,postLikeCount:r.like_count,postDetailUrl:r.url}),e("hr",{}),e(Ne,{parentId:t,anyComments:r.comment_count>0,requestUserId:o,requestUserIsStaff:n})]})]})};const Ce=({requestUserId:t})=>{t=parseInt(t);const o=isNaN(t)?"/api/v1/profiles/most-followers/":`/api/v1/profiles/${t}/follow-suggestions/`,{data:n,loading:r,error:s}=L(o);return i("div",{children:[r&&e(k,{}),n&&i("div",{class:"follow-suggestions my-4",children:[e("h4",{children:"People you might know"}),e("ul",{class:"list-group",children:n.map((l,a)=>e("li",{class:"list-group-item d-flex flex-column",children:i("div",{class:"w-100 p-2 d-flex align-items-center justify-content-center flex-wrap",children:[e("div",{class:"follow-suggestion-img",children:e("a",{href:l.profile_url,children:e("img",{class:"profile-picture-medium rounded",src:l.profile_picture,alt:"Profile picture"})})}),e("div",{class:"w-100 text-center mt-1",children:e("a",{href:l.profile_url,children:e("span",{class:"pointer-hover-underline text-break",children:l.username})})})]})},a))})]})]})},Pe=()=>{const{data:t,loading:o,error:n}=L("/api/v1/posts/most-commented/"),r=s=>s.substring(0,20)+"...";return i("div",{children:[o&&e(k,{}),t&&i("div",{class:"follow-suggestions my-4",children:[e("h4",{children:"Popular posts"}),e("ul",{class:"list-group my-4",children:t.map((s,l)=>i("li",{class:"list-group-item d-flex justify-content-between align-items-start",children:[i("div",{class:"ms-2 me-auto",children:[e("a",{href:s.url,children:e("div",{class:"pointer-hover-underline fw-bold text-wrap text-break",children:s.body.length>20?r(s.body):s.body})}),e("a",{href:s.post_author.profile_url,children:i("span",{class:"pointer-hover-underline text-muted text-break text-wrap",children:["by ",s.post_author.username]})})]}),e("span",{class:"badge bg-primary rounded-pill",title:"Replies",children:s.comment_count>99?"+99":s.comment_count})]},l))})]})]})};b.defaults.baseURL="https://socially.bartoszmagiera.me";const R=document.getElementById("home-section");R&&P.render(e(S.StrictMode,{children:e(xe,N({},R.dataset))}),R);const B=document.getElementById("explore-feed");B&&P.render(e(S.StrictMode,{children:e(D,N({newestPost:null},B.dataset))}),B);const j=document.getElementById("follow-suggestions");j&&P.render(e(S.StrictMode,{children:e(Ce,N({},j.dataset))}),j);const J=document.getElementById("popular-posts");J&&P.render(e(S.StrictMode,{children:e(Pe,{})}),J);const U=document.getElementById("post-detail");U&&P.render(e(S.StrictMode,{children:e(ke,N({},U.dataset))}),U);const H=document.getElementById("profile-detail");H&&P.render(e(S.StrictMode,{children:e(we,N({},H.dataset))}),H);
